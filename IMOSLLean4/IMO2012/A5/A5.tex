Let $R$ be a ring and $S$ be a domain.
Find all functions $f : R \to S$ such that, for any $x, y \in R$,
\[ f(xy + 1) = f(x) f(y) + f(x + y). \tag{*}\label{2012a5-eq0} \]

\textbf{Warning.}
The original problem uses the above functional equation with $R = S = \R$ and an extra condition, $f(-1) \neq 0$.
This problem is an extreme buffed version of the original problem.
The difficulty level of this problem is far beyond the level of IMO.
Proceed with caution; the solution might be very hard to understand.









\subsection*{Answer}

Before proceeding, note the following.
Given a good function $f : R \to S$ and homomorphisms $\phi : R' \to R$ and $\iota : S \to S'$, it is easy to check that $\iota \circ f \circ \phi$ is good.
The functions we will list below are the "initial" functions.
All good functions are of form $\phi \circ f \circ \iota$ where $f$ is a good function on the list.
Here is the list of initial functions:

\begin{itemize}

    \item
    The zero function.
    
    \item
    The function $x \in R \mapsto x - 1$ on a ring $R$.

    \item
    The function $x \in R \mapsto x^2 - 1 \in R_2$, where $R$ is a commutative ring and $R_2$ is the subring of $R$ generated by squares.
    
    \item
    One of the six functions below:
    \begin{align*}
        \F_2 &\to \Z    & \F_3 &\to \Z    & \F_3 &\to \Z    & \Z/4\Z &\to \Z  & \F_2[X]/\langle X^2 \rangle &\to \Z   & \F_4 &\to \Z[\varphi] \\
        0 &\mapsto -1   & 0 &\mapsto -1   & 0 &\mapsto -1   & 0 &\mapsto -1   & 0 &\mapsto -1                         & 0 &\mapsto -1 \\
        1 &\mapsto 0    & 1 &\mapsto 0    & 1 &\mapsto 0    & 1 &\mapsto 0    & 1 &\mapsto 0                          & 1 &\mapsto 0  \\
                       && 2 &\mapsto 1    & 2 &\mapsto 0    & 2 &\mapsto 1    & X &\mapsto 1                          & X &\mapsto \varphi  \\
                                                       &&&&&& 3 &\mapsto 0    & X + 1 &\mapsto 0                      & X + 1 &\mapsto 1 - \varphi
    \end{align*}
    For the last function, $\varphi$ is the golden ratio $\frac{1 + \sqrt{5}}{2}$.

\end{itemize}









\subsection*{Solution}

It is easy to check that the zero function and $x \mapsto x - 1$ are good.
To check the third function, it suffices to check that $x \mapsto x^2 - 1$ on a commutative ring is good, which can be bashed.
Finally, the six functions in the above table have finite input ring, so again we can bash to verify that they are all good functions.
Now we focus on proving that there are no other good functions.

We say that a good function $f : R \to S$ is \emph{non-trivial good} if $f(1) = 0$ and $f(0) = -1$.
We say that $f$ is \emph{reduced good} if $f$ is non-trivial and $f$ has no non-zero periodic element.
That is, $f(x + c) = f(x + d)$ for all $x \in R$ implies $c = d$.

We start with some easy observations.
Plugging $x = y = 1$ yields $f(1) = 0$.
Then plugging $y = 0$ yields either $f \equiv 0$ and $f(0) = -1$.
That is, if $f$ is not the zero function, then $f$ is non-trivial good.
We now continue with more observations.




\subsubsection*{Quasi-periodic elements}

We say that $c \in R$ is \emph{quasi-periodic} if one of the following conditions hold:
\begin{itemize}
    \item   $f(c + x) = -f(c) f(x)$ for all $x \in R$,
    \item   $f(cx + 1) = 0$ for all $x \in R$,
    \item   $f(x + c) = -f(x) f(c)$ for all $x \in R$,
    \item   $f(xc + 1) = 0$ for all $x \in R$.
\end{itemize}

Actually, we will show shortly that these four conditions are all equivalent.
Indeed, by~\eqref{2012a5-eq0}, the first two and the last two are equivalent.
For the first and third, we prove a more general result.

\begin{claim}
For any $c \in R$ satisfying the first or the third condition, we have $f(c) = f(-c) = \pm 1$.
\end{claim}
\begin{proof}
By symmetry, we can assume that $c \in R$ satisfies the first condition.
Then $f(c + 1) = -f(c) f(1) = 0$, and so~\eqref{2012a5-eq0} with $(x, y) = (c + 1, -1)$ yields $f(-c) = f(c)$.
For the last equality, note that $-f(c)^2 = -f(c) f(-c) = f(0) = -1$.
Thus we get $f(c)^2 = 1 \iff f(c) = \pm 1$.
\end{proof}

In particular, $f(c)$ always commutes with $f(x)$.
This shows that the first and third condition are indeed equivalent.
Thus, all four conditions are indeed equivalent.

Now let $J \subseteq R$ be the set of quasi-periodic elements.
The first condition yields that $J$ is closed under addition.
The second and fourth condition yields that $J$ is closed under right and left multiplication by elements of $R$, respectively.
Thus, $J$ is a two-sided ideal of $R$.

\begin{lemma}\label{2012a5-quasi-periodic-non-zero}
Suppose that $f$ is reduced and $J$ contains a non-zero element, say $c$.
Then $R = \{0, 1, c, c + 1\}$.
\end{lemma}
\begin{proof}
First note that $f(c) = \pm 1$ for any $c \in J$.
If $f(c) = -1$, then $f(x + c) = f(x)$ for all $x \in R$ and thus $c = 0$.
Thus, if $c \in J$ is non-zero, then $f(c) = 1$.
This case is possible only if $\rchar(S) \nmid 2$, so we will assume this.

Now fix a non-zero element $c \in J$.
Then $f(c) = 1$, and so $f(x + c) = -f(x)$ for all $x \in R$.
For any $d \in J$ non-zero, this yields $1 = f(d) = -f(d - c)$.
So $f(d - c) = -1$ and so, since $d - c \in J$, this implies $d = c$.
In summary, $J = \{0, c\}$.

Next, we show that for any $d \in R$, if $dc = 0$, then $d \in J$.
Indeed, for any $x \in R$, we have
\[ f(dx + 1) = f(d(x + c) + 1) = f(d) f(x + c) + f(d + x + c) = -(f(d) f(x) + f(d + x)) = -f(dx + 1). \]
Since $\rchar(S) \nmid 2$, this means $f(dx + 1) = 0$ for all $x \in J$.
Thus $d \in J$, as desired.

Finally, for any $r \in R$, we have $rc \in J = \{0, c\}$, so either $rc = 0$ or $(r - 1)c = 0$.
By the above result, the former yields $r \in \{0, c\}$, and the latter yields $r \in \{1, c + 1\}$.
\end{proof}




\subsubsection*{Periodic elements}

Consider the set $I$ of periodic elements of $R$ (with respect to $f$).
That is, $I = \{c \in R : \forall x \in R, f(x + c) = f(x)\}$.
Here, we prove that $I$ is in fact a double-sided ideal of $R$.
Clearly $I$ is a group under addition, so we just have to prove that it is closed under multiplication from both sides.
By symmetry, it suffices to show that $dc \in I$ for any $d \in R$ and $c \in I$.

Let $J$ be the ideal of quasi-periodic elements as in the previous part.
Clearly, $c \in I$ implies $f(c) = f(0) = -1$ and $c \in J$.
The converse is easy to check, so we have
\[ c \in I \iff c \in J \wedge f(c) = -1. \]

Now fix $c \in I$ and $d \in R$; the goal is to show that $dc \in I$.
Since $J$ is a two-sided ideal, we have $dc \in J$ and thus $f(dc) = \pm 1$.
The goal is to show that $f(dc) = -1$.

\begin{proof}
Since $c \in I$, for any $x \in R$ we have
\[ f(d) f(c + x) + f(d + c + x) = f(d) f(x) + f(d + x) \implies f(dc + dx + 1) = f(dx + 1). \]
But $dc \in J$, so this gives us $-f(dx + 1) = f(dx + 1)$.
Thus, either $\rchar(S) = 2$ or $f(dx + 1) = 0$ for all $x \in R$.
In the former case, we are done since $f(dc) = \pm 1 = -1$.
The latter case means that $d \in J$.
Thus, for any $d \in R$, either $dc \in I$ or $d \in J$.

Now if $d \in J$, then $d - 1 \notin J$, so $(d - 1)c \in I$.
Since $c \in I$, we still get $dc \in I$.
Either way, we have $dc \in I$ for any $d \in R$, as desired.
\end{proof}

Since $I$ is a two-sided ideal and $f(x + c) = f(x)$ for any $c \in I$, $f$ lifts to a function $\tilde{f} : R/I \to S$.
That is, $\tilde{f}$ satisfies $f = \tilde{f} \circ q$, where $q : R \to R/I$ is the canonical quotient map.
One can check that $\tilde{f}$ is a reduced good map.
Using this result, from now on, we can assume that $f$ is a reduced good map whenever necessary.




\subsubsection*{A solver for $f(x + 1) = f(x) + 1$.}

We now solve the problem when $f(x + 1) = f(x) + 1$ for all $x \in R$.
The result is as follows:

\begin{lemma}\label{2012a5-linear-solver}
Let $f : R \to S$ be a non-trivial good map such that $f(x + 1) = f(x) + 1$ for all $x \in R$.
Then $f + 1$ is a ring homomorphism.
\end{lemma}
\begin{proof}
First we reduce the lemma to showing that $f + 1$ is additive.
Equivalently, $f(x + y) = f(x) + f(y) + 1$ for all $x, y \in R$.
Indeed, if $f + 1$ is additive, then for any $x, y \in R$,
\[ f(xy) + 1 = f(xy + 1) = f(x) f(y) + f(x + y) = f(x) f(y) + f(x) + f(y) + 1 = (f(x) + 1)(f(y) + 1). \]
Thus $f + 1$ is multiplicative.
Since $f(1) + 1 = 1$, this would prove that $f + 1$ is a ring homomorphism.
Before proceeding, note that for any $x, y \in R$,
\[ f(xy) = f(xy + 1) - 1 = f(x) f(y) + f(x + y) - 1. \]

Now fix $x, y \in R$; we show that $f(x + y) = f(x) + f(y) + 1$.
The trick is to write $f(x(x + 1) y + 1)$ in two ways.
Let $a = f(x)$, $b = f(y)$, and $c = f(x + y)$, and note again that $f(x + 1) = f(x) + 1$ for all $x \in R$.
We get
\begin{align*}
    a f((x + 1) y) + f(x + (x + 1) y) &= (a + 1) f(xy) + f(x + 1 + xy) \\
    a((a + 1) b + c) + (a + 1)(b + 1) + c &= (a + 1) (ab + c - 1) + a(b + 1) + c + 1
\end{align*}
    which simplifies to $c = a + b + 1$ after some heavy algebraic manipulation.
It is the desired equality.
\end{proof}




\newpage
\subsubsection*{Case 1: $f(-1) \neq 0$}

By replacing $(x, y)$ with $(x + 1, -1)$ in~\eqref{2012a5-eq0}, we get
\[ f(-x) = f(x + 1) f(-1) + f(x). \tag{1.1}\label{2012a5-eq1-1} \]
Using~\eqref{2012a5-eq1-1} twice yields $f(x) = f(-x) + f(-x + 1) f(-1) = f(-x) - f(x + 1) f(-1)$.
Since $f(-1) \neq 0$, this gives us $f(-x + 1) = -f(x + 1)$, or
\[ f(-x) = -f(x + 2). \tag{1.2}\label{2012a5-eq1-2} \]
In particular, $f(2) = 1$.
Now we prove more equalities.

By comparing $(x, y)$ with $(-x, -y)$, we get
\[ f(-x) f(-y) + f(-(x + y)) = f(x) f(y) + f(x + y). \tag{1.3}\label{2012a5-eq1-3} \]
By plugging $y = 2$ into~\eqref{2012a5-eq0} and using~\eqref{2012a5-eq1-2}, we get
\[ f(2x + 1) = f(x) - f(-x). \tag{1.4}\label{2012a5-eq1-4} \]

Now we show that for any $x \in R$,
\[ f(x + 1) = 0 \vee f(-x) + f(x) = f(-1), \tag{1.5}\label{2012a5-eq1-5} \]
By~\eqref{2012a5-eq1-3} with $y = x$, we get
\[ f(x)^2 - f(-x)^2 = f(-2x) - f(2x). \]
Since $x$ and $-x$ commute, so does $f(x)$ and $f(-x)$.
Thus the LHS factors as $(f(x) - f(-x))(f(x) + f(-x))$.
Applying~\eqref{2012a5-eq1-4} on the LHS and~\eqref{2012a5-eq1-1} on the RHS gives
\[ f(2x + 1) (f(x) + f(-x)) = f(2x + 1) f(-1). \]
Thus either $f(2x + 1) = 0$ or $f(x) + f(-x) = f(-1)$.
But combining~\eqref{2012a5-eq1-4} and~\eqref{2012a5-eq1-1} yields $f(2x + 1) = -f(x + 1) f(-1)$.
Since $f(-1) \neq 0$, $f(2x + 1) = 0$ implies $f(x + 1) = 0$, as desired.

Next, we show that
\[ f(x + 1) = 0 \implies f(-x) = f(x) = -1. \tag{1.6}\label{2012a5-eq1-6} \]
First note that~\eqref{2012a5-eq1-1} already gives $f(-x) = f(x)$.
Now~\eqref{2012a5-eq1-3} with $y = -(x + 1)$ gives
\[ f(x) f(-(x + 1)) + f(-1) = 0 \iff f(x) f(-(x + 1)) = -f(-1). \]
Meanwhile, with $y = x + 1$, we get
\[ f(-x) f(-(x + 1)) + f(-(2x + 1)) = f(2x + 1). \]
Note that $f(-x) = f(x)$, so applying the previous equality and using~\eqref{2012a5-eq1-4} gives
\[ -f(-1) - f(-x) f(-1) = -f(x + 1) f(-1) = 0. \]
Since $f(-1) \neq 0$, this gives $f(-x) = -1$.
This proves~\eqref{2012a5-eq1-6}.

\begin{claim}
We have $f(-1) \in \{-2, 1\}$.
\end{claim}
\begin{proof}
Recall that $f(2) = 1$.
By~\eqref{2012a5-eq0} with $x = y = -1$, we have $f(-2) = 1 - f(-1)^2$.
By~\eqref{2012a5-eq1-5} with $x = -2$, since $f(-1) \neq 0$, we have $f(-2) = f(-1) - 1$.
Thus we have $1 - f(-1)^2 = f(-1) - 1$, which implies the claim.
\end{proof}

We now split cases based on the value of $f(-1)$.

\begin{itemize}

    \item
    $f(-1) = -2$ and $\rchar(S) \nmid 2$.
    
    Then combining~\eqref{2012a5-eq1-5} with~\eqref{2012a5-eq1-6} yields $f(-x) + f(x) = -2$ for all $x \in R$.
    Combining with~\eqref{2012a5-eq1-1} now gives $2 f(x + 1) = 2 (f(x) + 1)$ for all $x \in R$.
    Since $\rchar(S) \nmid 2$, this gives us $f(x + 1) = f(x) + 1$ for all $x \in R$.
    We are done by Lemma~\ref{2012a5-linear-solver}.


    \item
    $f(-1) = 1$ and $\rchar(S) \nmid 3$.

    We will assume that $f$ is reduced in this subcase.
    We start by strengthening~\eqref{2012a5-eq1-6}: $f(x + 1) = 0$ implies $x = 0$.
    Indeed, $f(-x) = f(x) = -1$, so~\eqref{2012a5-eq1-3} yields
    \[ -f(-y) + f(-(x + y)) = -f(y) + f(x + y) \iff f(-(x + y)) - f(x + y) = f(-y) - f(y). \]
    By~\eqref{2012a5-eq1-1} and $f(-1) \neq 0$, we get $f(x + y + 1) = f(y + 1)$ for all $y \in R$.
    Replace $y$ with $y - 1$, and we get that $f$ is $x$-periodic, thus $x = 0$.

    By~\eqref{2012a5-eq1-5}, we have $f(-x) + f(x) = 1$ if $x \neq 0$.
    By~\eqref{2012a5-eq1-1} and~\eqref{2012a5-eq1-2}, we get $f(x) + f(x + 1) + f(x + 2) = 0$ for all $x \in R$.
    Thus, it is clear that $f$ is $3$-periodic, hence $\rchar(R) \mid 3$.
    Next, for any $x \in R$,
    \[ f(x) + f(x + 1) + f(x + 2) + f(-x) + f(-(x + 1)) + f(-(x + 2)) = 0. \]
    If $x \notin \{0, 1, 2\}$, then we would have $3 = 0$ in $S$, contradicting $\rchar(S) \nmid 3$.
    Thus, $R = \{0, 1, 2\}$, and it is easy to check now that $R \cong \F_3$.
    The isomorphism then induces the second map ($\F_3 \to \Z$) on the table.

\end{itemize}




\newpage
\subsubsection*{Case 2: $f(-1) = 0$, $\rchar(R) \nmid 2$}

\iffalse
Plugging $y = -1$ into~\eqref{2012a5-eq0} immediately implies that $f$ is even.
In particular, by replacing $y$ with $-y$ in~\eqref{2012a5-eq0} yields
\[ f(xy - 1) = f(x) f(y) + f(x - y). \tag{2.1}\label{2012a5-eq2-1} \]
Applying~\eqref{2012a5-eq0} and the above equation to $f(2x + 1) = f(2(x + 1) - 1)$ yields
\[ f(x) f(2) + f(x + 2) = f(x + 1) f(2) + f(x - 1). \tag{2.2}\label{2012a5-eq2-2} \]
\fi

%% ...




\newpage
\subsubsection*{Case 3: $\rchar(R) \mid 2$}

In this subcase, we rely on the following three equations deduced from~\eqref{2012a5-eq0}:
\[ f(x^2 + x + 1) = f(x) f(x + 1) \tag{3.1}\label{2012a5-eq3-1} \]
\[ f(x^2 + 1) = f(x)^2 - 1 \tag{3.2}\label{2012a5-eq3-2} \]
The above also gives $f(x^2) = f(x + 1)^2 - 1$ for any $x \in R$.
Next, comparing~\eqref{2012a5-eq0} using $(x, x^2 + x)$ and $(x^2, x + 1)$ yields
\[ f(x) f(x^2 + x) + f(x^2) = f(x^2) f(x + 1) + f(x^2 + x + 1). \]
By~\eqref{2012a5-eq3-1},~\eqref{2012a5-eq3-2}, and some rearranging, we get
\[ f(x) f(x^2 + x) = (f(x + 1)^2 - 1)(f(x + 1) - 1) + f(x) f(x + 1). \tag{3.3}\label{2012a5-eq3-3} \]
Next, we prove that for any $x \in R$,
\[ f(x)^2 + f(x + 1)^2 = 1 \vee f(x) + f(x + 1) = 1. \tag{3.4}\label{2012a5-eq3-4} \]

\begin{proof}
Write $f(x) f(x + 1) f(x^2 + x)$ in two ways using~\eqref{2012a5-eq3-3}:
\[ f(x + 1) ((f(x + 1)^2 - 1)(f(x + 1) - 1) + f(x) f(x + 1)) = f(x) ((f(x)^2 - 1)(f(x) - 1) + f(x + 1) f(x)). \]
Note that this can be regarded as an equality in commutative rings since $f(x)$ and $f(x + 1)$ commute.
Rearranging yields
\[ (f(x + 1) - f(x))(f(x)^2 + f(x + 1)^2 - 1)(f(x) + f(x + 1) - 1) = 0. \]
So either~\eqref{2012a5-eq3-4} holds, or $f(x + 1) = f(x)$.

In the latter case,~\eqref{2012a5-eq3-3} becomes $f(x) f(x^2 + x) = f(x)^3 - f(x) + 1$.
Note that by~\eqref{2012a5-eq3-1} and~\eqref{2012a5-eq3-2},
\[ f(x^2 + x)^2 = f(x^4 + x^2 + 1) + 1 = f(x^2) f(x^2 + 1) + 1 = (f(x)^2 - 1)^2 + 1. \]
For convenience, if we denote $f(x) = c$, we get
\[ c^2 (c^4 - 2c^2 + 2) = (c^3 - c + 1)^2 \iff (1 - 2c)(c^2 - 1) = 0. \]
If $2c = 1$, then we are done as $f(x) + f(x + 1) = 2c$.
Otherwise, $f(x^2) = f(x^2 + 1) = c^2 - 1 = 0$.
Plugging back into~\eqref{2012a5-eq3-3} with $x$ replaced by $x^2$ yields a contradiction.
\end{proof}

In particular, if $\rchar(S) \mid 2$, we are done.
Indeed,~\eqref{2012a5-eq3-4} yields $f(x + 1) = f(x) + 1$ for all $x \in R$.
Then Lemma~\ref{2012a5-linear-solver} yields that $f + 1$ is a ring homomorphism.
Thus, from now on, we assume that $\rchar(S) \nmid 2$.

The next statement we prove is
\[ f(x) = 0 \vee f(x + 1) = 0 \vee (f(x) + f(x + 1) = 1 \wedge f(x) f(x + 1) = -1). \tag{3.5}\label{2012a5-eq3-5} \]

\begin{proof}
First notice that by double application of~\eqref{2012a5-eq3-2}, for any $x \in R$,
\[ f(x^4) = (f(x)^2 - 1)^2 - 1 = f(x)^4 - 2 f(x)^2. \]
Now write $f(x^8 + x^4 + 1)$ in two ways, using the above and using~\eqref{2012a5-eq3-1}.
Since $f(x^2 + x + 1) = f(x) f(x + 1)$, we get
\[ (f(x)^4 - 2 f(x)^2)(f(x + 1)^4 - 2 f(x + 1)^2) = (f(x) f(x + 1))^4 - 2 (f(x) f(x + 1))^2, \]
    which rearranges to
\[ (f(x) f(x + 1))^2 (f(x)^2 + f(x + 1)^2 - 3) = 0 \iff f(x) = 0 \vee f(x + 1) = 0 \vee f(x)^2 + f(x + 1)^2 = 3. \]
The last case, by~\eqref{2012a5-eq3-4}, also implies $f(x) + f(x + 1) = 1$, as $f(x)^2 + f(x + 1)^2 = 1$ is impossible.
Then expanding $(f(x) + f(x + 1))^2$ and simplifying yields $f(x) f(x + 1) = -1$, as desired.
\end{proof}

By~\eqref{2012a5-eq3-3}, if $f(x) = 0$, we know that $f(x + 1) = \pm 1$.
On the other hand,~\eqref{2012a5-eq3-5} gives us the converse, so we have
\[ f(x) = 0 \iff f(x + 1) = \pm 1. \tag{3.6}\label{2012a5-eq3-6} \]
Next, we prove the following:
\[ f(r) = -1 \implies r = 0. \tag{3.7}\label{2012a5-eq3-7} \]

\begin{proof}
By~\eqref{2012a5-eq3-6}, $f(r) = -1$ implies $f(r + 1) = 0$.
Plugging into~\eqref{2012a5-eq3-2} yields $f(r^2) = -1$.
Meanwhile, plugging back into~\eqref{2012a5-eq3-3} gives $f(r^2 + r) = -1$.
Note again that this holds for any $r \in R$ such that $f(r) = -1$.

Plugging into~\eqref{2012a5-eq0} yields $f(rx + 1) = f(x + r) - f(r)$ for any $x \in R$.
This also yields $f(r^2 + rx + 1) = -f(rx + 1)$ since $\rchar(R) \mid 2$.
In particular, for any $y \in R$ of form $rx + 1$ for some $x$, we have $f(r^2 + y) = -f(y)$.

Apply the same reasoning with $r^2$ and $r^2 + r$ in place of $r$.
For the former, we have $f(r^4 + y) = -f(y)$ if $y$ is of form $r^2 x + 1$.
These numbers are also of form $rx + 1$ for some $x \in R$, so we get $f(r^4 + r^2 + y) = -f(r^2 + y) = f(y)$.
On the other hand, we have $f(r^4 + r^2 + y) = -f(y)$ if $y$ is of form $(r^2 + r) x + 1$ for some $x \in R$.
Thus, since $\rchar(S) \nmid 2$, this implies $f(y) = 0$ if $y$ is of both forms.
In particular, $f((r^3 + r^2) x + 1) = 0$ for all $r \in R$, so $r^3 + r^2$ is quasi-perodic.
The same holds for $r^4 + r^2 = (r^3 + r^2)(r + 1)$.
Since $f(r) = -1 \implies f(r^2) = -1 \implies f(r^4 + r^2) = -1$, we get $r^4 + r^2 = 0$.

Now go back to the equality $f(r^4 + r^2 + y) = -f(y)$, which holds whenever $y$ is of form $(r^2 + r) x + 1$ for some $x \in R$.
Since $r^4 + r^2 = 0$, this yields $f((r^2 + r) x + 1) = 0$ for all $x \in R$, so $r^2 + r$ is quasi-periodic.
Since $f(r^2 + r) = -1$, we get $r^2 + r = 0$.
Finally,~\eqref{2012a5-eq0} yields that for any $x \in R$,
\[ 0 = f((r + 1)rx + 1) = f(rx + r + 1) = f(r(x + 1) + 1). \]
So $r$ is quasi-periodic.
Since $f(r) = -1$, this gives $r = 0$, as desired.
\end{proof}

As a result, these are the following possible cases for an element $r \in R$:
\begin{itemize}
    \item   $r = 0$ or $r = 1$;
    \item   $(f(r), f(r + 1)) = (1, 0)$, for which $r^2 = 0$ but $r \neq 0$;
    \item   $(f(r), f(r + 1)) = (0, 1)$, for which $r^2 = 1$ but $r \neq 1$;
    \item   $f(r) + f(r + 1) = 1$ and $f(r) f(r + 1) = -1$, for which $r^2 + r + 1 = 0$.
\end{itemize}

Note that $r$ falls into the second category if and only if $r + 1$ falls into the third category.
Thus, in the ring $R$, every element $r$ either satisfies $r^2 = 0$, $r^2 = 1$, or $r^2 + r + 1 = 0$.
We now analyze such rings and in fact show that it is isomorphic to $\F_2$, $\F_2[\varepsilon]$, or $\F_4$.

...
